# Deployment System Structure

This document describes the structure and organization of the deployment system.

## Directory Layout

```
deployment/
├── src/                          # TypeScript source code
│   ├── types/                   # Type definitions
│   │   ├── deployment.ts        # Core interfaces and types
│   │   └── deployment.test.ts   # Type definition tests
│   └── index.ts                 # Main entry point
│
├── dist/                         # Compiled JavaScript (generated by tsc)
│   ├── types/
│   │   ├── deployment.js
│   │   ├── deployment.d.ts
│   │   └── ...
│   └── index.js
│
├── dockerfiles/                  # Dockerfile definitions
│   └── .gitkeep                 # (Dockerfiles will be added in Task 2)
│
├── scripts/                      # Helper scripts
│   └── .gitkeep                 # (Scripts will be added in Task 5)
│
├── config/                       # Configuration files
│   ├── .env.example             # Example environment configuration
│   └── .gitkeep                 # (docker-compose.yml will be added in Task 3)
│
├── node_modules/                 # Dependencies (generated by npm)
│
├── package.json                  # Node.js project configuration
├── package-lock.json            # Locked dependency versions
├── tsconfig.json                # TypeScript compiler configuration
├── jest.config.js               # Jest test configuration
├── .eslintrc.json               # ESLint configuration
├── .gitignore                   # Git ignore patterns
├── README.md                    # Project documentation
└── STRUCTURE.md                 # This file
```

## Core Type Definitions

The `src/types/deployment.ts` file contains all core TypeScript interfaces:

### Deployment State Management
- `DeploymentState`: Tracks deployment version, status, and health
- `HealthCheckResult`: Individual service health check results
- `DeploymentResult`: Result of a deployment operation

### Configuration
- `DeploymentConfiguration`: Complete deployment settings
- `SSHConfig`: SSH connection configuration
- `BuildOptions`: Docker build configuration
- `DeploymentOptions`: CLI options for deployment script
- `CertificateConfig`: HTTPS certificate configuration

### Docker Resources
- `DockerImage`: Docker image metadata
- `ContainerConfig`: Container configuration
- `VolumeConfig`: Docker volume configuration
- `HealthCheckConfig`: Container health check settings

## Dependencies

### Production Dependencies
- **ssh2**: SSH client for remote host connections
- **dockerode**: Docker API client for image operations
- **commander**: CLI argument parsing
- **winston**: Structured logging

### Development Dependencies
- **typescript**: TypeScript compiler
- **jest**: Testing framework
- **ts-jest**: TypeScript support for Jest
- **eslint**: Code linting
- **@typescript-eslint**: TypeScript-specific linting rules

## Build Process

1. **TypeScript Compilation**: `npm run build`
   - Compiles `src/**/*.ts` to `dist/**/*.js`
   - Generates type definitions (`.d.ts`)
   - Creates source maps for debugging

2. **Testing**: `npm test`
   - Runs Jest test suite
   - Uses ts-jest for TypeScript support
   - Generates coverage reports

3. **Linting**: `npm run lint`
   - Checks code style with ESLint
   - Enforces TypeScript best practices

## Configuration Files

### tsconfig.json
- Target: ES2022
- Module: ES2022 (ESM)
- Strict mode enabled
- Source maps and declarations generated

### jest.config.js
- Preset: ts-jest
- Test environment: Node.js
- Test pattern: `**/*.test.ts` and `**/*.spec.ts`
- Coverage collection from all source files

### .eslintrc.json
- Parser: @typescript-eslint/parser
- Extends: ESLint recommended + TypeScript recommended
- Custom rules for unused variables and explicit types

## Next Steps

The following will be added in subsequent tasks:

1. **Task 2**: Dockerfile definitions in `dockerfiles/`
2. **Task 3**: Docker Compose configuration in `config/`
3. **Task 5**: Database initialization scripts in `scripts/`
4. **Task 6+**: Deployment script modules in `src/`

## Testing Strategy

- **Unit Tests**: Verify specific functionality and edge cases
- **Property-Based Tests**: Verify universal correctness properties
- **Integration Tests**: End-to-end deployment scenarios

All tests are co-located with source files using `.test.ts` suffix.
